(()=>{document.addEventListener("DOMContentLoaded",()=>{downloadBtn.style.display="none";let o={input:document.getElementById("file"),label:document.querySelector(".labelFile"),resultImage:document.getElementById("result-image"),spinner:document.getElementById("mainLoader"),processBtn:document.getElementById("processBtn"),downloadBtn:document.getElementById("downloadBtn"),imgDefault:document.getElementById("imgDefault"),fileNameDisplay:document.querySelector(".file-name"),downloadLink:document.querySelector(".mainBtnDownload a")};f(o)});function f({input:o,processBtn:e,fileNameDisplay:c,imgDefault:y,spinner:t,resultImage:a,downloadBtn:d,downloadLink:g}){let l=null;o.addEventListener("change",m=>{if(l=m.target.files[0],!l)return;e.disabled=!1,c.innerHTML=`<strong>Imagen seleccionada: </strong>${l.name}`,document.querySelector(".processBtn").style.marginTop="3rem";let i=e.cloneNode(!0);e.replaceWith(i),e=i,e.addEventListener("click",async()=>{if(!l)return;y.style.display="none",a.style.display="none",t.style.display="block",e.disabled=!0;let s=new FormData;s.append("image",l);try{let n=await fetch("/process",{method:"POST",body:s});if(!n.ok){let u=await n.text();alert("Error del servidor: "+u),t.style.display="none",e.disabled=!1;return}let r=await n.json();t.style.display="none",e.disabled=!1,r.result&&(t.style.display="none",a.src=`data:image/png;base64,${r.result}`,a.style.display="block",d.href=a.src,d.setAttribute("download","foto-attach.png"),d.style.display="inline-block")}catch(n){alert("Error de red o JS: "+n),t.style.display="none",e.disabled=!1}}),d.style.display="none"})}})();
